<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESon 2.0 - 관리자 패널</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body class="bg-neutral-50 text-neutral-900">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="hidden fixed inset-0 bg-neutral-900 bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 flex flex-col items-center shadow-xl">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-neutral-900"></div>
      <p class="mt-4 text-neutral-700 loading-message">로딩 중...</p>
    </div>
  </div>

  <!-- Header -->
  <header class="bg-white border-b border-neutral-200 fixed top-0 left-0 right-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-neutral-900 rounded-lg flex items-center justify-center">
            <svg class="w-4 h-4 text-white" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4H42V17.3333V30.6667H24V44H6V30.6667V17.3333H24V4Z" fill="currentColor"></path>
            </svg>
          </div>
          <h1 class="text-lg font-semibold">ESon 2.0 - 관리자 패널</h1>
        </div>
        
        <nav class="flex items-center gap-6">
          <a href="/chat.html" class="text-sm font-medium text-neutral-600 hover:text-neutral-900">채팅으로 돌아가기</a>
          <div class="flex items-center gap-4">
            <span id="userName" class="text-sm text-gray-600"></span>
            <button id="logoutBtn" class="px-4 py-2 text-sm bg-red-600 text-white rounded hover:bg-red-700">
              로그아웃
            </button>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <div id="adminApp" class="pt-16 min-h-screen flex">
    <!-- Sidebar -->
    <aside class="w-80 flex-shrink-0 bg-white border-r border-neutral-200 flex flex-col">
      <div class="p-4 border-b border-neutral-200">
        <h2 class="text-sm font-semibold text-neutral-900 mb-3">관리 메뉴</h2>
      
        <button id="uploadBtn" class="btn-primary w-full text-sm mb-4">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 256 256">
            <path d="M240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a8,8,0,0,1,16,0v64H224V136a8,8,0,0,1,16,0ZM85.66,77.66,120,43.31V136a8,8,0,0,0,16,0V43.31l34.34,34.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,77.66Z"></path>
          </svg>
          문서 업로드
        </button>
      </div>
        
      <nav class="flex-1 p-4 overflow-y-auto">
        <ul class="space-y-2">
          <li>
            <button data-section="documents" class="nav-btn nav-btn-active w-full text-left px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 256 256">
                <path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"></path>
              </svg>
              문서 관리
            </button>
          </li>
          <li>
            <button data-section="bigquery" class="nav-btn w-full text-left px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 256 256">
                <path d="M224,48H32A16,16,0,0,0,16,64V192a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48ZM32,192V64H224V192ZM72,104v48a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm32,0v48a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm32,0v48a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm56,40a8,8,0,0,1-8,8H168v8a8,8,0,0,1-16,0v-8H152a8,8,0,0,1,0-16h32a8,8,0,0,0,0-16H168a24,24,0,0,0-24,24v8a24,24,0,0,0,24,24h8v8a8,8,0,0,0,16,0v-8a8,8,0,0,0,0-16H168a8,8,0,0,1,0-16h16A8,8,0,0,1,192,144Z"></path>
              </svg>
              BigQuery 연동
            </button>
          </li>
        </ul>
      </nav>
      
      <div class="p-4 border-t border-neutral-200">
        <div class="text-xs text-neutral-500 mb-2">시스템 정보</div>
        <div class="text-xs text-neutral-600">
          <div id="currentTime"></div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0">

      <!-- Content Sections -->
      <div class="flex-1 overflow-y-auto p-6">
        <!-- Documents Section -->
        <section id="documents" class="section-content">
          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-sm text-neutral-600">전체 문서</div>
              <div class="text-2xl font-bold text-neutral-800" id="totalDocuments">0</div>
            </div>
          </div>

          <!-- Document Table -->
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <!-- Table Header -->
            <div class="px-6 py-4 border-b border-neutral-200">
              <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                  <input type="text" 
                         id="searchInput" 
                         placeholder="문서 검색..." 
                         class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <select id="filterSelect" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="all">모든 상태</option>
                    <option value="active">활성</option>
                    <option value="processing">처리 중</option>
                    <option value="deleted">삭제됨</option>
                  </select>
                </div>
                <button id="bulkDeleteBtn" 
                        disabled 
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-neutral-300 disabled:cursor-not-allowed transition-colors">
                  선택 삭제
                </button>
              </div>
            </div>

            <!-- Table -->
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-neutral-200">
                <thead class="bg-neutral-50">
                  <tr>
                    <th class="px-6 py-3 text-left">
                      <input type="checkbox" id="selectAll" class="rounded border-neutral-300">
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      문서명
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      유형
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      업로드 일시
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      상태
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      작업
                    </th>
                  </tr>
                </thead>
                <tbody id="documentTableBody" class="bg-white divide-y divide-neutral-200">
                  <!-- Documents will be rendered here -->
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <div class="px-6 py-4 border-t border-neutral-200 bg-neutral-50">
              <div class="flex justify-between items-center">
                <div class="text-sm text-neutral-700">
                  <span id="showingStart">0</span> - <span id="showingEnd">0</span> / 
                  총 <span id="totalDocs">0</span>개
                </div>
                <div class="flex space-x-1">
                  <button id="prevPage" class="px-3 py-1 border border-neutral-300 rounded-lg hover:bg-neutral-100 disabled:opacity-50 text-sm transition-colors">
                    이전
                  </button>
                  <div id="pageNumbers" class="flex space-x-1">
                    <!-- Page numbers will be rendered here -->
                  </div>
                  <button id="nextPage" class="px-3 py-1 border border-neutral-300 rounded-lg hover:bg-neutral-100 disabled:opacity-50 text-sm transition-colors">
                    다음
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- BigQuery Section -->
        <section id="bigquery" class="section-content hidden">
          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-sm text-neutral-600">연동 상태</div>
              <div id="bigqueryStatus" class="text-2xl font-bold text-neutral-800">-</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-sm text-neutral-600">테이블 수</div>
              <div id="tableCount" class="text-2xl font-bold text-neutral-800">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-sm text-neutral-600">데이터셋</div>
              <div id="datasetId" class="text-sm font-medium text-neutral-800">-</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-sm text-neutral-600">마지막 갱신</div>
              <div id="lastRefresh" class="text-sm font-medium text-neutral-800">-</div>
            </div>
          </div>

          <!-- Table Management -->
          <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-neutral-200">
              <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold text-neutral-900">테이블 관리</h3>
                <button id="refreshSchemasBtn" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M224,48V96a8,8,0,0,1-8,8H168a8,8,0,0,1,0-16h28.69L182.06,73.37a79.56,79.56,0,0,0-56.13-23.43h-.45A79.52,79.52,0,0,0,69.59,72.71,8,8,0,0,1,58.41,61.27a96,96,0,0,1,135,.79L208,76.69V48a8,8,0,0,1,16,0ZM186.41,183.29a80,80,0,0,1-112.47-.66L59.31,168H88a8,8,0,0,0,0-16H40a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V179.31l14.63,14.63A95.43,95.43,0,0,0,130,222.06h.53a95.36,95.36,0,0,0,67.07-27.33,8,8,0,0,0-11.18-11.44Z"></path>
                  </svg>
                  테이블 목록 새로고침
                </button>
              </div>
            </div>
            <div class="p-6">
              <div id="schemaInfo" class="space-y-4">
                <p class="text-sm text-gray-600">
                  챗봇은 BigQuery의 모든 테이블에 자동으로 접근할 수 있습니다. 
                  아래 목록은 현재 사용 가능한 테이블을 보여줍니다.
                </p>
              </div>
            </div>
          </div>

          <!-- Table List -->
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b border-neutral-200">
              <h3 class="text-lg font-semibold text-neutral-900">테이블 목록</h3>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-neutral-200">
                <thead class="bg-neutral-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      테이블명
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      설명
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      컬럼 수
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">
                      행 수
                    </th>
                  </tr>
                </thead>
                <tbody id="tableListBody" class="bg-white divide-y divide-neutral-200">
                  <!-- Tables will be rendered here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Upload Modal -->
  <div id="uploadModal" class="modal hidden fixed inset-0 bg-neutral-900 bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4">
      <div class="px-6 py-4 border-b border-neutral-200 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-neutral-900">문서 업로드</h3>
        <button data-close-modal class="text-neutral-400 hover:text-neutral-600">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 256 256">
            <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
          </svg>
        </button>
      </div>
      <div class="p-6">
        <div class="border-2 border-dashed border-neutral-300 rounded-xl p-6 text-center hover:border-neutral-400 transition-colors">
          <input type="file" 
                 id="fileInput" 
                 multiple 
                 accept=".pdf,.docx,.txt,.md"
                 class="hidden">
          <label for="fileInput" class="cursor-pointer">
            <div class="w-16 h-16 bg-neutral-100 rounded-full flex items-center justify-center mx-auto">
              <svg class="w-8 h-8 text-neutral-600" fill="currentColor" viewBox="0 0 256 256">
                <path d="M240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a8,8,0,0,1,16,0v64H224V136a8,8,0,0,1,16,0ZM85.66,77.66,120,43.31V136a8,8,0,0,0,16,0V43.31l34.34,34.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,77.66Z"></path>
              </svg>
            </div>
            <p class="mt-4 text-sm text-neutral-600">
              클릭하여 파일을 선택하세요
            </p>
            <p class="mt-1 text-xs text-neutral-500">
              지원 형식: PDF, DOCX, TXT, MD
            </p>
          </label>
        </div>
        <div id="fileList" class="mt-4 hidden">
          <!-- Selected files will be shown here -->
        </div>
      </div>
      <div class="px-6 py-4 border-t border-neutral-200 flex justify-end space-x-3">
        <button data-close-modal class="btn-secondary text-sm">
          취소
        </button>
        <button id="uploadConfirmBtn" class="btn-primary text-sm">
          업로드
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="fixed bottom-4 right-4 z-50"></div>

  <!-- Scripts -->
  <script type="module">
    // Update time
    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = 
        now.toLocaleString('ko-KR', { 
          year: 'numeric', 
          month: '2-digit', 
          day: '2-digit', 
          hour: '2-digit', 
          minute: '2-digit' 
        });
    }
    updateTime();
    setInterval(updateTime, 60000);
  </script>
  <script type="module" src="/src/js/admin.js"></script>
</body>
</html>